<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test PWA - Budget Pro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #4F46E5;
      margin-bottom: 24px;
      font-size: 32px;
    }
    
    .status {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      font-weight: 500;
    }
    
    .status.success {
      background: #10b981;
      color: white;
    }
    
    .status.error {
      background: #ef4444;
      color: white;
    }
    
    .status.warning {
      background: #f59e0b;
      color: white;
    }
    
    .section {
      margin-bottom: 32px;
      padding-bottom: 32px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .section:last-child {
      border-bottom: none;
    }
    
    h2 {
      color: #1f2937;
      margin-bottom: 16px;
      font-size: 20px;
    }
    
    .icons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .icon-card {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .icon-card img {
      width: 96px;
      height: 96px;
      margin: 0 auto 8px;
      border-radius: 8px;
      background: white;
      padding: 8px;
    }
    
    .icon-card .label {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }
    
    .checklist {
      list-style: none;
    }
    
    .checklist li {
      padding: 12px;
      margin-bottom: 8px;
      background: #f9fafb;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .checklist li::before {
      content: '‚úì';
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: #10b981;
      color: white;
      border-radius: 50%;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .checklist li.error::before {
      content: '‚úó';
      background: #ef4444;
    }
    
    .install-btn {
      background: #4F46E5;
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
    }
    
    .install-btn:hover {
      background: #4338ca;
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(79, 70, 229, 0.3);
    }
    
    .install-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }
    
    .info-box {
      background: #eff6ff;
      border: 2px solid #3b82f6;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
    }
    
    .info-box strong {
      color: #1e40af;
      display: block;
      margin-bottom: 8px;
    }
    
    code {
      background: #1f2937;
      color: #10b981;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test PWA - Budget Pro</h1>
    
    <div id="pwa-status" class="status warning">
      ‚è≥ V√©rification en cours...
    </div>
    
    <div class="section">
      <h2>üì± Manifest Web App</h2>
      <ul class="checklist" id="manifest-checks">
        <li>Chargement du manifest...</li>
      </ul>
    </div>
    
    <div class="section">
      <h2>üé® Ic√¥nes PWA</h2>
      <div class="icons-grid" id="icons-grid">
        <!-- Ic√¥nes seront inject√©es ici -->
      </div>
    </div>
    
    <div class="section">
      <h2>‚ö° Actions Rapides (Shortcuts)</h2>
      <ul class="checklist" id="shortcuts-list">
        <li>Chargement des shortcuts...</li>
      </ul>
    </div>
    
    <div class="section">
      <h2>üîß Installation</h2>
      <button id="install-btn" class="install-btn" disabled>
        üì≤ Installer Budget Pro
      </button>
      <div class="info-box">
        <strong>Comment installer manuellement :</strong>
        <p>1. Ouvrir <code>http://localhost:9002</code> dans Chrome</p>
        <p>2. Cliquer sur l'ic√¥ne <code>+</code> dans la barre d'adresse</p>
        <p>3. Cliquer sur "Installer"</p>
      </div>
    </div>
    
    <div class="section">
      <h2>üß™ Tests Chrome DevTools</h2>
      <div class="info-box">
        <strong>Ouvrir DevTools (F12) :</strong>
        <p>1. Onglet <code>Application</code> ‚Üí <code>Manifest</code></p>
        <p>2. V√©rifier que "Installable" = <code>Yes</code></p>
        <p>3. Voir toutes les ic√¥nes et shortcuts</p>
      </div>
    </div>
  </div>
  
  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');
    const statusDiv = document.getElementById('pwa-status');
    
    // Charger et afficher le manifest
    async function testManifest() {
      try {
        const response = await fetch('/manifest.webmanifest');
        const manifest = await response.json();
        
        const checks = [
          { label: `Nom: "${manifest.name}"`, pass: !!manifest.name },
          { label: `Display: ${manifest.display}`, pass: manifest.display === 'standalone' },
          { label: `Orientation: ${manifest.orientation}`, pass: manifest.orientation === 'portrait' },
          { label: `Theme Color: ${manifest.theme_color}`, pass: !!manifest.theme_color },
          { label: `${manifest.icons.length} ic√¥nes d√©finies`, pass: manifest.icons.length >= 2 },
          { label: `${manifest.shortcuts?.length || 0} shortcuts`, pass: (manifest.shortcuts?.length || 0) > 0 },
        ];
        
        const checksList = document.getElementById('manifest-checks');
        checksList.innerHTML = checks.map(check => 
          `<li class="${check.pass ? '' : 'error'}">${check.label}</li>`
        ).join('');
        
        // Afficher les ic√¥nes
        const iconsGrid = document.getElementById('icons-grid');
        iconsGrid.innerHTML = manifest.icons.map(icon => `
          <div class="icon-card">
            <img src="${icon.src}" alt="${icon.purpose}" onerror="this.style.display='none'">
            <div class="label">${icon.sizes}<br>${icon.purpose}</div>
          </div>
        `).join('');
        
        // Afficher les shortcuts
        if (manifest.shortcuts) {
          const shortcutsList = document.getElementById('shortcuts-list');
          shortcutsList.innerHTML = manifest.shortcuts.map(shortcut => 
            `<li>${shortcut.name} ‚Üí <code>${shortcut.url}</code></li>`
          ).join('');
        }
        
        // Status final
        const allPassed = checks.every(c => c.pass);
        statusDiv.className = `status ${allPassed ? 'success' : 'warning'}`;
        statusDiv.textContent = allPassed 
          ? '‚úÖ Manifest PWA valide !' 
          : '‚ö†Ô∏è Manifest PWA partiel (voir d√©tails)';
        
      } catch (error) {
        statusDiv.className = 'status error';
        statusDiv.textContent = '‚ùå Erreur: ' + error.message;
      }
    }
    
    // G√©rer l'installation PWA
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.disabled = false;
      installBtn.textContent = 'üì≤ Installer Budget Pro (disponible)';
    });
    
    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) {
        alert('L\'installation n\'est pas disponible. Utilisez Chrome et assurez-vous que l\'app n\'est pas d√©j√† install√©e.');
        return;
      }
      
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        installBtn.textContent = '‚úÖ Installation r√©ussie !';
        installBtn.disabled = true;
      } else {
        installBtn.textContent = '‚ùå Installation annul√©e';
      }
      
      deferredPrompt = null;
    });
    
    window.addEventListener('appinstalled', () => {
      statusDiv.className = 'status success';
      statusDiv.textContent = 'üéâ Budget Pro install√© avec succ√®s !';
      installBtn.textContent = '‚úÖ Application install√©e';
      installBtn.disabled = true;
    });
    
    // Lancer les tests
    testManifest();
  </script>
</body>
</html>
